  
jobs:

  push_checker:
    name: Daily Interlisp Push Check and Build
    runs-on: ubuntu-latest
    outputs:
      desired_tag: ${{ steps.current_name.outputs.medley }}
      cache_hit: ${{ steps.check_sha.outputs.cache-hit }}
      latest_tag: ${{ steps.latest_medley_version.outputs.latest_tag }}
    steps:
      - name:  Create cache file
        run: |
          mkdir check-SHA
          echo ${{ github.sha }} > github-sha.txt

      - name: Check SHA
        id: check_sha
        uses: actions/cache@v2.1.7
        with:
          path: check-SHA
          key: check-SHA-$${{ github.sha }}

      # Get Medley release information, retrieves the name of the latest
      # release. 
      - name: Get Medley Release Information
        id: latest_medley_version
        uses: abatilo/release-info-action@v1.3.0
        with:
          owner: Interlisp
          repo: medley

      - name: Get current Release Name
        id: current_name
        run: |
          echo "Execute additional steps"
          echo ::set-output name=medley::"medley-`date +%y%m%d`"

#  check_if_build_needed:
#    needs: push_checker     
#    runs-on: ubuntu-latest
#    steps:
#      - uses: build_medley

  do_build_medley:
    needs: push_checker
    runs-on: ubuntu-latest
    # uses: stumbo/medley/.github/workflows/buildLoadup.yml@master
    # if: push_checker.outputs.cache_hit # &&  push_checker.outputs.latest_tag != push_checker.outputs.desired_tag
    steps:
     - name: do work
       run: |
        echo "Cache Hit:  ${{ needs.push_checker.outputs.cache_hit }} "
        echo "Desired Tag: " ${{ needs.push_checker.outputs.desired_tag }}
        echo "Latest Tag: " ${{ needs.push_checker.outputs.latest_tag }}